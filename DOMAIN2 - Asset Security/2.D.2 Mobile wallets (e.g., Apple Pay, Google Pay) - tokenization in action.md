
**ğŸ§¾ Phase 1 â€“ Card Enrollment (Creating the Token)**

When you first add your card to a mobile wallet (e.g., Apple Pay, Google Pay):

1. You enter your card details into the wallet app (either typing them or scanning the card).

2. The wallet (token requestor) sends these details to a Token Service Provider (TSP) such as Visa Token Service (VTS) or Mastercard Digital Enablement Service (MDES).

3. The TSP checks with your issuing bank to confirm your identity (step-up authentication like an OTP or app approval).

4. The TSP creates a digital token (DPAN) that replaces your real card number (FPAN) and stores both securely in the Token Vault.

5. That token (DPAN) is sent back to your device and saved in the secure element (or in the cloud using Host Card Emulation).

From now on, every transaction from that device uses the token, not your real card number.

```mermaid
sequenceDiagram
    autonumber
    participant C as Cardholder
    participant W as X-Pay Wallet (App)
    participant TSP as Token Service Provider
    participant TV as Token Vault
    participant IB as Issuer Bank

    C->>W: Enter card details (FPAN)
    W->>TSP: Request tokenization (Encrypted FPAN)
    TSP->>IB: Verify card & authenticate (OTP/App)
    IB-->>TSP: Validation OK
    TSP->>TV: Store mapping (FPAN <-> DPAN)
    TV-->>TSP: Mapping stored
    TSP-->>W: Return DPAN (Token)
    W-->>C: Card added successfully

```

**ğŸ¦ Phase 2 â€“ Making a Payment (Using the Token)**

When you make a contactless or online payment:

1. You tap your phone or confirm payment in the app.

2. The wallet sends the token (DPAN) plus a one-time cryptogram (a digital signature) to the merchantâ€™s POS.

3. The POS forwards the tokenized transaction to the payment network / TSP.

4. The TSP looks up the real FPAN in the Token Vault (this is called de-tokenization).

5. The TSP sends the real PAN and payment details to the issuer bank for authorization.

6. The bank approves or declines the transaction and the result travels back through the TSP and POS to your wallet.

```mermaid
sequenceDiagram
    autonumber
    participant D as Wallet (Device)
    participant POS as Merchant POS
    participant TSP as Token Service Provider
    participant TV as Token Vault
    participant IB as Issuer Bank

    D->>POS: Send DPAN + Cryptogram
    POS->>TSP: Forward tokenized transaction
    TSP->>TV: Request FPAN for DPAN
    TV-->>TSP: Return FPAN
    TSP->>IB: Request authorization (FPAN)
    IB-->>TSP: Approve / Decline
    TSP-->>POS: Send Auth Result
    POS-->>D: Payment Complete
```

ğŸ” Why Tokenization Is Powerful

- The real card number never leaves the bankâ€™s control.

- Each device or merchant gets a unique token, limiting reuse.

- Tokens can be revoked or suspended if a device is lost.

- It supports both contactless and online transactions safely.
